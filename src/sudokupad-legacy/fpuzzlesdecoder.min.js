const loadFPuzzle=(()=>{const o=20,t=(e=9)=>{let r=Math.sqrt(e);if(Number.isInteger(r))return[r,r];for(r=Math.floor(r);!Number.isInteger(e/r)&&1<r;)r--;return 0<r?[r,e/r]:[1,1]},n="#a8a8a8a8,#000,#ffa0a0,#ffdf61,#feffaf,#b0ffb0,#61d060,#d0d0ff,#8180f0,#ff08ff,#ffd0d0".split(","),a={UR:[-1,1],UL:[-1,-1],DR:[1,1],DL:[1,-1]},l="size,title,author,ruleset,clone,grid,disjointgroups,thermometer,killercage,arrow,difference,ratio,betweenline,lockout,quadruple,rectangle,circle,text,palindrome,line,minimum,maximum".split(","),g=(F=String.fromCharCode,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\\",C={},{decompress:function(t){if(null==t)return"";if(""==t)return null;var e,r,o,a,n,l,i,s=t.length,c=32,u=function(e){var r=b,e=t.charAt(e);if(!C[r]){C[r]={};for(var o=0;o<r.length;o++)C[r][r.charAt(o)]=o}return C[r][e]},h=[],d=4,f=4,g=3,p="",m=[],v={val:u(0),position:c,index:1};for(e=0;e<3;e++)h[e]=e;for(o=0,n=Math.pow(2,2),l=1;l!=n;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=c,v.val=u(v.index++)),o|=(0<a?1:0)*l,l<<=1;switch(o){case 0:for(o=0,n=Math.pow(2,8),l=1;l!=n;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=c,v.val=u(v.index++)),o|=(0<a?1:0)*l,l<<=1;i=F(o);break;case 1:for(o=0,n=Math.pow(2,16),l=1;l!=n;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=c,v.val=u(v.index++)),o|=(0<a?1:0)*l,l<<=1;i=F(o);break;case 2:return""}for(r=h[3]=i,m.push(i);;){if(s<v.index)return"";for(o=0,n=Math.pow(2,g),l=1;l!=n;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=c,v.val=u(v.index++)),o|=(0<a?1:0)*l,l<<=1;switch(i=o){case 0:for(o=0,n=Math.pow(2,8),l=1;l!=n;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=c,v.val=u(v.index++)),o|=(0<a?1:0)*l,l<<=1;h[f++]=F(o),i=f-1,d--;break;case 1:for(o=0,n=Math.pow(2,16),l=1;l!=n;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=c,v.val=u(v.index++)),o|=(0<a?1:0)*l,l<<=1;h[f++]=F(o),i=f-1,d--;break;case 2:return m.join("")}if(0==d&&(d=Math.pow(2,g),g++),h[i])p=h[i];else{if(i!==f)return null;p=r+r.charAt(0)}m.push(p),h[f++]=r+p.charAt(0),r=p,0==--d&&(d=Math.pow(2,g),g++)}},compress:function(e){if(null===e)return"";var r=function(e,r,o){if(null==e)return"";var t,a,n,l={},i={},s="",c="",u="",h=2,d=3,f=2,g=[],p=0,m=0;for(n=0;n<e.length;n++)if(s=e.charAt(n),Object.prototype.hasOwnProperty.call(l,s)||(l[s]=d++,i[s]=!0),c=u+s,Object.prototype.hasOwnProperty.call(l,c))u=c;else{if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<f;t++)p<<=1,m==r-1?(m=0,g.push(o(p)),p=0):m++;for(a=u.charCodeAt(0),t=0;t<8;t++)p=p<<1|1&a,m==r-1?(m=0,g.push(o(p)),p=0):m++,a>>=1}else{for(a=1,t=0;t<f;t++)p=p<<1|a,m==r-1?(m=0,g.push(o(p)),p=0):m++,a=0;for(a=u.charCodeAt(0),t=0;t<16;t++)p=p<<1|1&a,m==r-1?(m=0,g.push(o(p)),p=0):m++,a>>=1}0==--h&&(h=Math.pow(2,f),f++),delete i[u]}else for(a=l[u],t=0;t<f;t++)p=p<<1|1&a,m==r-1?(m=0,g.push(o(p)),p=0):m++,a>>=1;0==--h&&(h=Math.pow(2,f),f++),l[c]=d++,u=String(s)}if(""!==u){if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<f;t++)p<<=1,m==r-1?(m=0,g.push(o(p)),p=0):m++;for(a=u.charCodeAt(0),t=0;t<8;t++)p=p<<1|1&a,m==r-1?(m=0,g.push(o(p)),p=0):m++,a>>=1}else{for(a=1,t=0;t<f;t++)p=p<<1|a,m==r-1?(m=0,g.push(o(p)),p=0):m++,a=0;for(a=u.charCodeAt(0),t=0;t<16;t++)p=p<<1|1&a,m==r-1?(m=0,g.push(o(p)),p=0):m++,a>>=1}0==--h&&(h=Math.pow(2,f),f++),delete i[u]}else for(a=l[u],t=0;t<f;t++)p=p<<1|1&a,m==r-1?(m=0,g.push(o(p)),p=0):m++,a>>=1;0==--h&&(h=Math.pow(2,f),f++)}for(a=2,t=0;t<f;t++)p=p<<1|1&a,m==r-1?(m=0,g.push(o(p)),p=0):m++,a>>=1;for(;;){if(p<<=1,m==r-1){g.push(o(p));break}m++}return g.join("")}(e,6,function(e){return b.charAt(e)});switch(r.length%4){default:case 0:return r;case 1:return r+"===";case 2:return r+"==";case 3:return r+"="}}});var F,b,C;const u=(e,r,o,t=!1)=>{void 0===e[r]&&(e[r]=[]),!0===t&&((e,r,o)=>{o=JSON.stringify(o);return(e[r]||[]).map(e=>JSON.stringify(e)).includes(o)})(e,r,o)||("object"!=typeof o||Array.isArray(o)||(o=Object.keys(o).reduce((e,r)=>Object.assign(e,void 0===o[r]?{}:{[r]:o[r]}),{})),e[r].push(o))},i=(r,t,[a,n])=>{var l=r.grid.length,r=r.grid[0].length;for(let o=Math.max(0,a-1),e=Math.min(r-1,a+1);o<=e;o++)for(let e=Math.max(0,n-1),r=Math.min(l-1,n+1);e<=r;e++)u(t,"foglight",[o,e],!0)},s=(e,r)=>{r=Object.assign(r,{cellSize:50,cells:[],regions:[]}),e.metadata&&(r.metadata=Object.assign(e.metadata));let l=t(e.size||9),i={};e.grid.forEach((e,a)=>{let n=[];u(r,"cells",n),e.forEach((e,r)=>{var o,t={},t=(n.push(t),e.given&&(t.value=e.value),e.centerPencilMarks&&(t.centremarks=e.centerPencilMarks),e.cornerPencilMarks&&(t.pencilMarks=e.cornerPencilMarks),t=a,o=r,null===(e=e.region)?"null":void 0===e?Math.floor(t/l[0])*l[0]+Math.floor(o/l[1]):Number(e));void 0===i[t]&&(i[t]=[]),i[t].push([a,r])})}),void 0!==i.null&&(u(r,"cages",{cells:i.null,unique:!1,hidden:!0}),delete i.null),Object.keys(i).forEach(e=>u(r,"regions",i[e]))},c=/^([^: ]+):\s*(.+)/m,h=/#([0-9a-f]{3}0|[0-9a-f]{6}00)/i,r=/^([.]*|0*)$/,d=(e,r,o)=>{void 0===e.metadata&&(e.metadata={});e=e.metadata;void 0===e[r]?e[r]=o:(Array.isArray(e[r])||(e[r]=[e[r]]),e[r].push(o))},f=(e,n)=>{(e.cage||[]).forEach(e=>{var r,o,t,a;t=0===((r=e).cells||[]).length,a=h.test(r.fontC||"#0000")&&h.test(r.outlineC||"#0000"),r=c.test(String(r.value)||""),(t||a)&&r&&([o,t,a]=String(e.value||"").match(c)||[],d(n,t,a))})},p=(e,r)=>{var{metadata:o={}}=r;if(void 0===o.solution){var t=/^\d$/,a=[];for(const n of e.grid)for(const l of n){if(!t.test(l.value))return;a.push(t.test(l.value)?l.value.toString():"?")}o=a.join("");d(r,"solution",o)}},m=e=>e.match(/R([0-9]+)C([0-9]+)/).slice(1,3).map(Number).map(e=>e-1),v=(o,t)=>([e,r])=>[e+o,r+t],y=e=>{var r,{cell:o,cells:t}=e;if("string"==typeof o)return v(.5,.5)(m(o));if(Array.isArray(t)&&0<t.length)return[o,r]=t.reduce(([e,r],o)=>v(e+.5,r+.5)(m(o)),[0,0]),[o/(o=t.length),r/o];throw new Error("Unable to calculate part center for: "+JSON.stringify(e))};var e=(o,t)=>(e,r)=>{e[o]&&u(r,"cages",{value:t+": "+e[o]})};const w=(e,r,o,t)=>{void 0===e[o]&&"function"==typeof t&&void 0!==(t=t(e,r))&&(r.cages=r.cages||[],void 0===r.cages.find(e=>0===(e.value||"").indexOf(o+": ")))&&r.cages.push({value:o+": "+t})};const z={size:(e,r)=>{},disabledlogic:(e,r)=>{},truecandidatesoptions:(e,r)=>{},grid:(e,a)=>{e.grid.forEach((e,t)=>{e.forEach((e,r)=>{let o=e.c||(e.cArray||[])[0];Array.isArray(e.cArray)&&1<e.cArray.length&&console.warn("f-puzzles decoder does not currently support multiple given colors. Please submit this puzzle for testing."),void 0!==n[parseInt(o)]&&(o=n[parseInt(o)]),[null,void 0].includes(o)||u(a,"underlays",{backgroundColor:o,center:[t+.5,r+.5],rounded:!1,width:1,height:1})})})}},k=(z.author=e("author","author"),z.title=e("title","title"),z.author=e("author","author"),z.ruleset=e("ruleset","rules"),z.isSolutionBlank=e=>r.test(e),z.mapSolDigit=e=>(1<(e=String(e)).length&&(console.warn('parsing fpuz: solution value "%s" not supported, substituting "?"',e),e="?"),e),z.solution=(e,r)=>{let o=e.solution||[];e=(o="string"==typeof o?o.split(-1!==o.indexOf(",")?",":""):o).map(z.mapSolDigit).join("");z.isSolutionBlank(e)||u(r,"cages",{value:"solution: "+e})},z.antiknight=(e,r)=>{d(r,"antiknight",e.antiknight),e.antiknight&&u(r,"global","antiknight")},z.antiking=(e,r)=>{d(r,"antiking",e.antiking),e.antiking&&u(r,"global","antiking")},z.nonconsecutive=(e,r)=>{e.nonconsecutive&&u(r,"global","nonconsecutive")},z.littlekillersum=(e,t)=>{(e.littlekillersum||[]).forEach(e=>{var r=v(.5,.5)(m(e.cell)),o=a[e.direction],e=void 0!==e.value?e.value:"_";u(t,"arrows",{color:"#000000",thickness:2,wayPoints:[[r[0]+.3*o[0],r[1]+.3*o[1]],[r[0]+.48*o[0],r[1]+.48*o[1]]]}),u(t,"overlays",{backgroundColor:"#FFFFFF",borderColor:"#FFFFFF",center:[r[0]-0*o[0],r[1]-0*o[1]],fontSize:28,width:.25,height:.25,rounded:!1,text:e})})},z.arrow=(e,a)=>{let n={};try{n=JSON.parse((a.metadata||{}).customstyle||"{}")}catch(e){console.warn('Invalid JSON in imported meta data "customStyle":',(a.metadata||{}).customstyle)}n.bulb&&n.bulb.color&&(n.bulb.borderColor=n.bulb.color),(e.arrow||[]).forEach(e=>{e.lines.forEach(e=>{e.length<=1&&console.error("Arrow has less than one point!");var e=e.map(m).map(v(.5,.5)),r=e[1][0]-e[0][0],o=e[1][1]-e[0][1],t=Math.sqrt(r*r+o*o);e[0][0]+=Math.round(40*Math.sign(r)/t)/100,e[0][1]+=Math.round(40*Math.sign(o)/t)/100,u(a,"arrows",Object.assign({color:"#a1a1a1",headLength:.3,thickness:5,wayPoints:e},n.arrow))});var r=e.cells.map(m).map(v(.5,.5)),[o,t]=(e=>{let r=[999,999],o=[-999,-999];return e.forEach(e=>{r[0]=Math.min(r[0],e[0]),o[0]=Math.max(o[0],e[0]),r[1]=Math.min(r[1],e[1]),o[1]=Math.max(o[1],e[1])}),[r,o]})(r);t[0]===o[0]||t[1]===o[1]?u(a,"overlays",Object.assign({borderColor:"#a1a1a1",backgroundColor:"#ffffff",center:y(e),fontSize:16,borderSize:5,rounded:!0,text:"",width:t[1]-o[1]+.83,height:t[0]-o[0]+.83},n.bulb)):(e=Math.round(.7*("undefined"!=typeof SvgRenderer?SvgRenderer.CellSize:64)),u(a,"lines",Object.assign({color:"#a1a1a1",thickness:e,opacity:.7,wayPoints:r},n.bulb)),u(a,"lines",Object.assign({color:"#ffffff",thickness:e-10,opacity:.8,wayPoints:r})))})},z.killercage=(e,t)=>{(e.killercage||[]).forEach(e=>{var r,o={unique:!0};Array.isArray(e.cells)&&(o.cells=e.cells.map(m)),e.value&&(o.value=e.value),r=e.value,Number.isInteger(Number(r))&&String(Number(r))===String(r)&&(o.sum=parseInt(e.value)),u(t,"cages",o)})},z.cage=(o,t)=>{const a=/^[a-z]+: /;(o.cage||[]).forEach(e=>{if("FOW"===e.value&&1===e.cells.length)return i(o,t,m(e.cells[0]));if("FOGLIGHT"===e.value)e.cells.forEach(e=>u(t,"foglight",m(e),!0));else{var r=Object.assign({},e,{cells:e.cells.map(m)});if(void 0===r.style)switch(e.fromConstraint){case"Row Indexer":r.style="fpRowIndexer";break;case"Column Indexer":r.style="fpColumnIndexer";break;case"Box Indexer":r.style="fpBoxIndexer"}"string"==typeof e.value&&e.value.match(a)&&delete r.cells,u(t,"cages",r)}})},z.fogofwar=(r,o)=>{(r.fogofwar||[]).forEach(e=>i(r,o,m(e)))},z.foglight=(e,r)=>{(e.foglight||[]).forEach(e=>u(r,"foglight",m(e),!0))},z["diagonal+"]=(e,r)=>{var o;e["diagonal+"]&&(e=r.cells.length,o=r.cells.reduce((e,r)=>Math.max(r.length,e),0),u(r,"lines",{color:"#34BBE6",thickness:2,wayPoints:[[0,o],[e,0]]}))},z["diagonal-"]=(e,r)=>{var o;e["diagonal-"]&&(e=r.cells.length,o=r.cells.reduce((e,r)=>Math.max(r.length,e),0),u(r,"lines",{color:"#34BBE6",thickness:2,wayPoints:[[0,0],[e,o]]}))},z.ratio=(e,o)=>{(e.ratio||[]).forEach(e=>{var r={borderColor:"#000000",backgroundColor:"#000000",center:y(e),rounded:!0,width:.3,height:.3,text:""};e.value&&(r.color="#fff",r.stroke="none",r.text=e.value),u(o,"overlays",r)})},z.difference=(e,o)=>{(e.difference||[]).forEach(e=>{var r={borderColor:"#000000",backgroundColor:"#FFFFFF",center:y(e),rounded:!0,width:.3,height:.3,text:""};e.value&&(r.color="#000",r.stroke="none",r.text=e.value),u(o,"overlays",r)})},z.xv=(e,r)=>{(e.xv||[]).forEach(e=>{u(r,"overlays",{backgroundColor:"#FFFFFF",borderColor:"#FFFFFF",center:y(e),fontSize:21,rounded:!1,width:.25,height:.25,text:e.value})})},z.thermometer=(e,r)=>{(e.thermometer||[]).forEach(e=>{e.lines.forEach(e=>{e=e.map(m).map(v(.5,.5));u(r,"underlays",{borderColor:"#CFCFCF",backgroundColor:"#CFCFCF",center:e[0],rounded:!0,width:.85,height:.85}),u(r,"lines",{color:"#CFCFCF",thickness:21,wayPoints:e})})})},z.palindrome=(e,r)=>{(e.palindrome||[]).forEach(e=>{e.lines.forEach(e=>{u(r,"lines",{color:"#CFCFCF",thickness:16,wayPoints:e.map(m).map(v(.5,.5))})})})},z.sandwichsum=(e,r)=>{(e.sandwichsum||[]).forEach(e=>{u(r,"overlays",{backgroundColor:"#FFFFFF",borderColor:"#FFFFFF",center:y(e),fontSize:32,rounded:!1,width:.25,height:.25,text:e.value})})},z.even=(e,r)=>{(e.even||[]).forEach(e=>{u(r,"underlays",{borderColor:"#CFCFCF",backgroundColor:"#CFCFCF",center:y(e),rounded:!1,width:.7,height:.7})})},z.odd=(e,r)=>{(e.odd||[]).forEach(e=>{u(r,"underlays",{borderColor:"#CFCFCF",backgroundColor:"#CFCFCF",center:v(.5,.5)(m(e.cell)),rounded:!0,width:.7,height:.7})})},z.extraregion=(e,r)=>{(e.extraregion||[]).forEach(e=>{e=e.cells.map(m);e.map(v(.5,.5)).forEach(e=>{u(r,"underlays",{backgroundColor:"rgba(207, 207, 207, 0.95)",center:e,rounded:!1,width:1,height:1})}),u(r,"cages",{cells:e,hidden:!0})})},z.clone=(e,r)=>{(e.clone||[]).forEach(e=>{[...e.cells,...e.cloneCells].map(m).map(v(.5,.5)).forEach(e=>{u(r,"underlays",{borderColor:"#CFCFCF",backgroundColor:"#CFCFCF",center:e,rounded:!1,width:1,height:1})})})},z.quadruple=(e,r)=>{(e.quadruple||[]).forEach(e=>{u(r,"overlays",{backgroundColor:"#FFFFFF",borderColor:"#000000",center:y(e),fontSize:14,rounded:!0,width:.7,height:.7,text:e.values.reduce((e,r,o)=>e+(o%2==1?" ":"")+(o%3==2?"\n":"")+r,"")})})},z.betweenline=(e,n)=>{(e.betweenline||[]).forEach(e=>{e.lines.forEach(e=>{var e=e.map(m).map(v(.5,.5)),r=e.length-1,o=(u(n,"overlays",{borderColor:"#CFCFCF",backgroundColor:"#FFFFFF",center:[...e[0]],fontSize:16,borderSize:2,rounded:!0,width:.8,height:.8}),u(n,"overlays",{borderColor:"#CFCFCF",backgroundColor:"#FFFFFF",center:[...e[r]],fontSize:16,borderSize:2,rounded:!0,width:.8,height:.8}),e[1][0]-e[0][0]),t=e[1][1]-e[0][1],a=Math.sqrt(o*o+t*t);e[0][0]+=Math.round(4*Math.sign(o)/a)/10,e[0][1]+=Math.round(4*Math.sign(t)/a)/10,o=e[r-1][0]-e[r][0],t=e[r-1][1]-e[r][1],a=Math.sqrt(o*o+t*t),e[r][0]+=Math.round(4*Math.sign(o)/a)/10,e[r][1]+=Math.round(4*Math.sign(t)/a)/10,u(n,"lines",{color:"#CFCFCF",thickness:2,wayPoints:e})})})},z.lockout=(e,r)=>{},z.minMax=(a,e=[],r=!0)=>{let n=[1,1],l=[a.cells.length,a.cells[0].length],i=r?.44:.39,s=r?.39:.44,c=e.map(({cell:e})=>e);e.forEach((e,r,o)=>{let t=y(e);u(a,"underlays",{backgroundColor:"#ccc",center:t,rounded:!1,width:1,height:1}),[[-1,0],[0,1],[1,0],[0,-1]].forEach(([e,r])=>{var o=[Math.floor(t[0]+e+1),Math.floor(t[1]+r+1)];o[0]<n[0]||o[1]<n[1]||o[0]>l[0]||o[1]>l[1]||-1!==c.indexOf(`R${o[0]}C`+o[1])||u(a,"lines",{color:"#000000",thickness:1,wayPoints:[[t[0]+e*i+.1*r,t[1]+r*i+.1*e],[t[0]+e*s,t[1]+r*s],[t[0]+e*i-.1*r,t[1]+r*i-.1*e]]})})})},z.minimum=(e,r)=>{z.minMax(r,e.minimum)},z.maximum=(e,r)=>{z.minMax(r,e.maximum,!1)},z.line=(e,o)=>{(e.line||[]).forEach(r=>{r.lines.forEach(e=>{u(o,"lines",{color:r.outlineC,thickness:32*r.width,wayPoints:e.map(m).map(v(.5,.5))})})})},z.rectangle=(e,r)=>{(e.rectangle||[]).forEach(e=>{u(r,"overlays",{backgroundColor:e.baseC,borderColor:e.outlineC,center:y(e),borderSize:1,rounded:!1,width:e.width,height:e.height,text:e.value,angle:e.angle})})},z.circle=(e,r)=>{(e.circle||[]).forEach(e=>{u(r,"overlays",{backgroundColor:e.baseC,borderColor:e.outlineC,textColor:e.fontC,center:y(e),borderSize:1,rounded:!0,width:e.width,height:e.height,text:e.value,angle:e.angle})})},z.text=(e,o)=>{(e.text||[]).forEach(e=>{var r=e.value&&String(e.value).replace(/ /g," ");"string"==typeof r&&0<r.length&&u(o,"overlays",{color:e.fontC,textStroke:["#fff","#ffffff"].includes((e.fontC||"").toLowerCase())?"#000":"#fff",center:y(e),fontSize:Math.round(32*(e.size||1)),rounded:!1,width:.25,height:.25,text:r,angle:e.angle})})},z.disjointgroups=(e,r)=>{var o,{regions:t=[]}=r,a=[],n=t.length,l=([o=[]]=[t],o.reduce((e,r)=>Math.max(r.length,e),0));for(let r=0;r<l;r++){a[r]=[];for(let e=0;e<n;e++)void 0!==t[e][r]&&a[r].push(t[e][r])}a.forEach(e=>u(r,"cages",{cells:e,unique:!0,type:"disjoint",style:null})),u(r,"global","disjoint")},z.negative=(e,r)=>{for(const o of e.negative||[])u(r,"global","anti"+o)},/^(fpuz(?:zles)?)(.*)/),x=e=>e.replace(k,"$2"),M=(e,l=1e3,i=400)=>{const s=g.decompress,c=/^[/](?=([^/]|$))/gm,u=/[^/][/](?=([^/]|$))/gm;let h=0,d=Date.now();const f=(r,o=1)=>{if(!(o<=0)){if(Date.now()-d>=l)return console.error("fixFPuzzleSlashes timed out after %sms",Date.now()-d);if(h++>=i)return console.error("fixFPuzzleSlashes exceeded %s max checks",h);var t,a=(e=>{let r,o=[];for(c.lastIndex=0,(r=c.exec(e))&&o.push(r.index),u.lastIndex=0;null!==(r=u.exec(e));)o.push(r.index+1);return o})(r),n=a.length;for(let e=0;e<n;e++)if(t=r.substring(0,a[e])+"/"+r.substring(a[e]),1===o){if(s(t))return t}else if(t=f(t,o-1))return t}};if(s(e))return e;let r=1,o;for(;!o&&h<i&&Date.now()-d<l;)o=f(e,r),r++;return o},S=(e,r)=>(r=decodeURIComponent(e)).length<e.length?r:e,E=(e,r="fpuzzle")=>r+md5Digest("string"==typeof e?e:g.compress(JSON.stringify(e))),P=e=>{let r=e;var o={id:E(r)},e=("string"==typeof r&&(r=JSON.parse(g.decompress(S(r)))),s(r,o),f(r,o),p(r,o),[...new Set([...l,...Object.keys(r)])].filter(e=>void 0!==r[e]));for(const t of e)"function"!=typeof z[t]?A.logUnsupported&&console.error("Unsupported feature:",t,r[t]):z[t](r,o);return w(r,o,"title",A.getDefaultTitle),w(r,o,"author",A.getDefaultAuthor),w(r,o,"rules",A.getDefaultRules),o},O=e=>e.length>o?Promise.resolve(e):fetch("/api/puzzle/"+e).then(e=>e.json()).then(e=>e.result),A=r=>Promise.resolve().then(()=>O(r)).then(x).then(P).then(e=>(r.length<o&&(e.id=r),PuzzleZipper.zip(JSON.stringify(e)))).catch(e=>(console.error("Error fetching FPuzzle:",e),Promise.reject(e)));const j=e=>JSON.parse(g.decompress(M(S(e)))),I=e=>g.compress(JSON.stringify(e));return A.reFPuzPrefix=k,A.stripPrefix=x,A.logUnsupported=!1,A.fetchRawId=O,A.createFpuzId=E,A.parseFPuzzle=P,A.decompressPuzzle=g.decompress,A.compressPuzzle=g.compress,A.fixFPuzzleSlashes=M,A.saveDecodeURIComponent=S,A.getRegionShape=t,A.getDefaultTitle=(e,r)=>"Untitled",A.getDefaultAuthor=(e,r)=>"Unknown",A.getDefaultRules=(e,r)=>"No rules provided for this puzzle. Please check the related video or website for rules.",A.cleanPuzzlePackage=e=>{if(e.match(k))try{var r=JSON.parse(loadFPuzzle.decompressPuzzle(S(e.replace(/^fpuzzles/,""))));(r.cage||[]).forEach(e=>{(e.value||"").match(/^customstyle: /)&&(e.cells.length=0)}),e="fpuzzles"+S(loadFPuzzle.compressPuzzle(JSON.stringify(r)))}catch(e){console.error(e)}return e},A.decodeFPuzzleData=j,A.encodeFPuzzleData=I,A.addSolution=(e,r)=>I(Object.assign(j(e),{solution:r.split("")})),A})();"undefined"!=typeof module&&(module.exports=loadFPuzzle);